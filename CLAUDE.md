# プロジェクト概要

## 目的

1. Django 製のシンプルな PR ダッシュボードの実装検証
2. PR レビュー自動化ワークフロー（Claude 連携）の検証
3. 学習用サンドボックスとしての改善サイクル運用

**重要**: 学習目的を優先した実装が含まれる可能性があります。実運用向けか判断しづらい場合は質問を先に投稿してください。

## 技術スタック

- Python 3.x（仮想環境利用前提）
- Django 6.0 系
- SQLite（開発デフォルト）
- Django Templates + 素の JS/CSS（`static/` 配下）

## コードレビューに関する注意事項

- GitHub API 制限で 65,536 文字を超える単一コメントは不可。長文は分割または inline コメントを活用。
- 変更が DB スキーマに影響する場合、`migrations/` の追加漏れを必ず確認。
- Secrets／環境変数（例: API キー）は `settings.py` で直接ハードコードしない。`.env` 想定かを確認し、記載がなければ質問する。
- Claude はレビュー専任とし、DB 変更系コマンド（`python manage.py makemigrations`/`migrate` など）は実行しない。必要に応じて実行依頼をコメントで伝える。

### DB マイグレーション運用メモ

- スキーマ変更を含む PR では作者がローカルで `python manage.py makemigrations` を実行し、生成された `migrations/` をコミットすること。
- 適用は開発者/CI 側で `python manage.py migrate` を実行する想定。Claude は適用やデータ投入を行わない。

## レビュー優先度

### 必須（Critical）

- セキュリティ: CSRF/XSS/SQLi/認可抜け、`@csrf_protect`・`csrf_token` の欠落
- データ破壊リスク: マイグレーション不整合、破壊的変更にロールバック手順がない
- エラーハンドリング欠如で 500 を誘発する経路

### 高（High）

- アーキテクチャ: ビューにロジックが集中しすぎていないか、`forms`/`services` への分離
- DB/パフォーマンス: N+1、不要なクエリ評価、未インデックス項目のフィルタ
- 可観測性: ログ・メトリクス不足で障害調査が困難になりそうな部分

### 中（Medium）

- テスタビリティ: `django.test.TestCase` 等のテスト追加・既存テストの更新
- テンプレート: エスケープ漏れ、コンテキストキー命名の一貫性
- 設定: `DEBUG`/`ALLOWED_HOSTS`/`SECURE_*` の扱い、設定値の環境分離

### 参考（Optional）

- より良い実装パターンの紹介（Class Based Views 化など）
- UX 改善やアクセシビリティ上の提案

## Django 固有のチェックポイント

- CSRF: POST/PUT/PATCH/DELETE を行うフォームや fetch で `csrf_token` を送っているか。
- 認可: ログイン必須画面に `login_required` や権限チェックが入っているか。
- モデル/マイグレーション: フィールド追加にデフォルトや `null` の扱いを検討しているか、既存データ移行が必要か。
- タイムゾーン: `timezone.now()` を使用し、naive datetime を避けているか。
- URL 逆引き: `reverse` / `url` テンプレートタグを使いハードコード URL を避けているか。
- 静的ファイル: `static` テンプレートタグを使用し、ビルド不要の構成で壊れていないか。

## レビュー出力フォーマット

各レビューコメントには以下を含めてください：

1. **優先度**: [Critical/High/Medium/Optional]
2. **カテゴリ**:
   - セキュリティ（認証/認可/CSRF/XSS/データ保護）
   - アーキテクチャ（関心分離/依存関係/ディレクトリ構成）
   - 可読性（命名/コメント/コード構造）
   - パフォーマンス（DB クエリ/キャッシュ/テンプレートレンダリング）
   - エラーハンドリング（例外処理/バリデーション/ユーザーフィードバック）
   - テスタビリティ（テスト容易性/モック可能性）
   - データモデル（モデル・マイグレーション設計）
3. **問題点**: 具体的な指摘
4. **理由**: なぜ問題なのか
5. **改善案**: 具体的なコード例を含む提案
6. **参考資料**: 関連ドキュメントやベストプラクティス（あれば）

**重要**: 以下の場合は改善案の前に質問を優先してください。

- コードの意図や要件が不明確なとき
- 実装方針が複数あり追加情報が必要なとき
- プロジェクト固有ルール（例: ログ出力方針、環境変数命名）が不明なとき

## レビュー対象外

- 学習目的の実験的 UI（過度なアニメーション等）で、PR 説明に「実験用」と明記されているもの
- サンドボックス用のダミーデータ変更のみの PR
